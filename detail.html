<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>상세페이지</title>
  <link rel="icon" type="image/png" href="/test/images/fav2.png" />
  <link rel="apple-touch-icon" href="/test/images/fav1.png" />
  <meta name="theme-color" content="#ffffff" />
  <style>
    body { font-family: "minion-pro", serif; background: #fff; margin:0; padding:0; }
    a { color: inherit; text-decoration: none; }
    .fixed-image img { width: 100%; max-width: 100%; display: block; margin-bottom: 10px; cursor: pointer; }
    .caption-group { font-size: 12px; margin-top: 20px; }
    .caption-group div { margin-bottom: 5px; }
    .image-viewer { position: fixed; top:0; left:0; width:100vw; height:100vh; background: rgba(0,0,0,.85); display:flex; justify-content:center; align-items:center; opacity:0; visibility:hidden; transition:.3s; z-index:5000; }
    .image-viewer.active { opacity:1; visibility:visible; }
    .image-viewer img { max-width:90%; max-height:90%; }
    .image-viewer::after { content:'×'; position: fixed; top:20px; right:30px; font-size:28px; color:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <div class="fixed-image" id="fixedImageContainer"></div>
  <div class="caption-group" id="captionGroup"></div>

  <div class="image-viewer" id="imageViewer">
    <img src="" alt="viewer" />
  </div>

  <script>
    async function loadDetail() {
      const res = await fetch("../../data.json");
      const data = await res.json();
      const pathParts = window.location.pathname.split("/");
      const idx = parseInt(pathParts[pathParts.length-2], 10) - 1;
      const item = data[idx];
      if(!item) return;

      // 이미지 로드
      const container = document.getElementById('fixedImageContainer');
      container.innerHTML = '';
      item.images.forEach(src => {
        const img = document.createElement('img');
        img.src = src;
        img.alt = item.title;
        container.appendChild(img);
      });

      // 캡션 로드
      const captionBox = document.getElementById('captionGroup');
      captionBox.innerHTML = `
        <div class="caption1">${item.title}</div>
        <div class="caption2">${item.year}, ${item.category}</div>
        <div class="caption3">${item.subtitle || '-'}</div>
        <div class="caption4">${item.info || ''}</div>
        <div class="caption5">${item.tags ? item.tags.join(', ') : ''}</div>
      `;

      // 이미지 뷰어
      const viewer = document.getElementById('imageViewer');
      const viewerImg = viewer.querySelector('img');
      container.querySelectorAll('img').forEach(img => {
        img.addEventListener('click', () => {
          viewerImg.src = img.src;
          viewer.classList.add('active');
        });
      });
      viewer.addEventListener('click', () => viewer.classList.remove('active'));
      document.addEventListener('keydown', e => { if(e.key==='Escape') viewer.classList.remove('active'); });
    }

    document.addEventListener('DOMContentLoaded', loadDetail);
  </script>
</body>
</html>
